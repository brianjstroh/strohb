# Ding Ding Ding

## Deploying your own website
1. Create AWS Account
2. Register a domain name with route 53.
3. In cloudformation, create a stack with new resources from a template, and upload the static_website.yml template.
4. Once the SiteCertificate resource creation is initiated, check your email inbox in 5-15 minutes for a link to approve your domain's certificate. Click the link, then the "Approve" button. CloudFormation should then complete without any issues.
5. To bring your site online, repoint your DNS nameservers to match your CloudFront nameservers. AWS _should_ propogate these automatically after some time, but I don't have the patience to wait 72 hours to see if AWS comes through.

## Set Up GitHub Actions
This is how you're going to update content on your website.

1. Fork this repository to your own GitHub account
2. In your forked repository, go to Settings > Secrets and variables > Actions > New repository secret
3. Back in the AWS Console, let's create an access key to your s3 bucket to automate your website deployments.
4. Name your first secret `AWS_ACCESS_KEY_ID`, and copy the "Access key" value from your {stack-name}-MyS3WebsiteFullAccessUser access key into your secret value. Then hit `Add secret`.
5. Name your second secret `AWS_SECRET_ACCESS_KEY`, and copy the "Secret access key" value from that same {stack-name}-MyS3WebsiteFullAccessUser access key into your secret value. Then hit `Add secret`.
6. Go back to your repository level in GitHub, then over your "Actions" tab.

## Publishing Content

### Setting up your environment
1. If you haven't already, install python on your computer.
2. Open your favorite IDE, and in a terminal create a new virtual environment for your repository: ```python -m venv env```
3. Install `poetry`: ```pip install poetry```
4. Activate your virtual environment: ```env/scripts/activate```
5. Install mkdocs: ```poetry install --only=docs --no-root```

### Creating your content
1. Clone your forked repository down to your computer.
2. Update the `AWS_S3_BUCKET` in .github\workflows\deploy-mkdocs.yml to match your domain name.
3. Update mkdocs.yml to your liking. At a minimum, you'll need the index.md page.
4. Clear out the docs/assets/ folder, and update index.md to reflect how you want your homepage to look.
5. To preview your website, run `mkdocs serve` in a terminal, then click the link to preview your site in a local browser.
6. Once you're satisfied with how your website will look, stage, commit and push your changes up to your forked GitHub repository. The deploy-mkdocs.yml will trigger automatically on commits to your `main` branch, so you'll need to merge your branch into `main` if you're on a development branch.
7. Check your domain to see your brand new website! :D Share out with your friends.

## Troubleshooting
- If you're waiting on email from AWS, keep waiting. They're slow :(
- If you don't see your content hosted on your domain 2 minutes after you push your branch up to GitHub, debug this in order:
    - Did you push directly to the main branch? If not, merge your branch into the main branch.
    - Did your GitHub Action not trigger? If not, check your repository settings and enable GitHub Actions if necessary. May require another push to the main branch.
    - Do you have content in your s3 bucket? If not, check that your GitHub Action ran successfully. If it failed due to credentials, check that you have set your GitHub secrets correctly. See [Set Up GitHub Actions](#set-up-github-actions).
    - Can you access your s3 bucket directly without your domain? In the AWS Console, go to S3 > Buckets > {bucket with your domain name} > Properties > Static website hosting (very bottom). Click the link to your Bucket website endpoint. If you see your content hosted here, continue on.
    - Can you access your content via your CloudFront distribution? In the AWS Console, got to CloudFront > Distributions > {your distribution} > General > Details. Copy the Distribution domain name, and paste it into your browser. If you see your content hosted here, congratulations! There's only one place left to check. DNS >:)
    - In the AWS Console, navigate to Route 53. Click on your Domain registration, and then your domain name. Under Details, you'll see 4 Name servers off to the right side. We need to ensure that these match to the domain servers in your Route 53 > Hosted zone. In a new tab or window, open Route 53 > Hosted zones > {your domain}, and check out the 4 Name servers on the right side of the Hosted zone details sections. Now in the tab or window where you have your registerd domain details open, click the Actions button and Edit name servers. One by one, overwrite the existing name servers with the ones listed in your Hosted Zone. Save these, and then check your domain again in your browser.